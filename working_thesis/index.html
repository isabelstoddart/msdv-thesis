
<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<style>

body{
  max-width: 1200px;
  margin: 0px auto;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

h1{
    text-align: center;
    line-height: 10px;
    font-size: 100px;
    font-style: Bold;
    z-index: 1;
    padding-top: 250px;
}


#title{
  height: 800px;
}


#container{
  position: relative;
}

#sections{
  width: 600px;
  position: relative;
  margin: 0px auto;
}

#sections > div{
  background: rgba(255,255,255,.5);
  padding: 10px;
  border-top: 1px solid;
  border-bottom: 1px solid;
  margin-bottom: 80vh;
}
#sections > div:last-child{
  margin-bottom: 30px;
}
#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  margin-left: 0px;
  width: 100%;
  position: -webkit-sticky;
  position: sticky;
  top: 0px;
  float: none;
}

pre{
    overflow: hidden;
  }


circle{
  fill: steelblue;
}

.mono{
  font-family: monospace;
}

svg{
  background-color: #eee;
}

</style>

<div id='title'>
  <h1>Lost to History</h1>
</div>


<div id='container' class='container-1'>
  <div id='graph'></div>
  <div id='sections'>
    <div>
      <h3>Connect text and graphics</h3>
      <span class='mono'>graph-scroll</span> 
      takes a selection of explanatory text sections and dispatches <span class='mono'>active</span> events as different sections are scrolled into to view. These active events are used to update a graph's state.
      <pre>
d3.graphScroll()
  .sections(d3.selectAll('#sections > div'))
  .on('active', function(i){
    console.log(i + 'th section active') })
      </pre>

    </div>

    <div>
      <h3>Highlight active text</h3>
      The top most text section scrolled into view is classed <span class='mono'>graph-scroll-active</span>. This makes it easy to highlight the active section with css: 
<pre>
#sections > div{
  opacity: .3
} 

#sections div.graph-scroll-active{
  opacity: 1;
}
</pre>
    </div>


    <div>
      <h3>Headers and footers</h3>
      To support headers and intro images/text, the explanatory text and graphic are wrapped with a container element:    
<pre>
&lt;h1&gt;Page Title&lt;/div&gt;
&lt;div id='container'&gt;
  &lt;div id='graph'&gt;&lt;/div&gt;
  &lt;div id='sections'&gt;
    &lt;div&gt;Section 0&lt;/div&gt;
    &lt;div&gt;Section 1&lt;/div&gt;
    &lt;div&gt;Section 2&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;h1&gt;Footer&lt;/h1&gt;
</pre>

    and passed to <span class='mono'>graphScroll</span>

<pre>
d3.graphScroll()
  .graph(d3.select('#graph'))
  .container(d3.select('#container'))
<pre>
    </div>

    <div>
      <h3>Sticky graph</h3>
      When the graph starts to scroll out of view, <span class='mono'>postiion: sticky</span> keeps the graph element stuck to the top of the page while the text scrolls by.
<pre>
#container{
  position: relative;
}

#sections{
  width: 340px;
}

#graph{
  margin-left: 40px;
  width: 500px;
  position: sticky;
  top: 0px;
  float: right;
}
</pre>
    </div>

  </div>

</div>

<h1>
  Multiple graphs work too!
</h1>

<div id='container' class='container-2'>
  <div id='graph'></div>

  <div id='sections'>
    <div>
      <h3>Mobile</h3>

      On mobile centering the graph and sections while adding a some padding for the first slide is a good option: 
<pre>
@media (max-width: 925px)  {
  #graph{
    width: 100%;
    transform: translate(-50%, 0);
    margin-left: 50%;
  }

  #sections{
    position: relative;
    margin: 0px auto;
    padding-top: 400px;
  }
}
</pre>
    </div>

    <div>
      <h3>Examples</h3>
      <p><a href='http://www.bloomberg.com/graphics/2015-auto-sales/'>Auto Sales</a></p>
      <p><a href='http://www.bloomberg.com/graphics/2015-measles-outbreaks/'>Measles</a></p>
      <p><a href='http://roadtolarissa.com/blog/2015/01/04/coloring-maps-with-d3/'>Coloring Maps</a></p>
      <!--<p><a href='http://www.bloomberg.com/graphics/2015-fifa-scandal/'>FIFA Scandal</a></p>-->
      <p><a href='http://www.bloomberg.com/graphics/2015-whats-warming-the-world/'>Global Warming</a></p>
      <p><a href='http://www.bloomberg.com/politics/graphics/2015-hillary-womens-movement-timeline/'>Hillary Clinton’s Debt to Feminism
</a></p>
      <p><a href='http://www.bloomberg.com/graphics/year-ahead-2016/'>The Year Ahead</a></p>
      <p><a href='http://www.bloomberg.com/graphics/2015-pace-of-social-change/'>Pace of Social Change</a></p>
      <p><a href='http://www.bloomberg.com/graphics/2015-red-meat-cancer/'>Red Meat</a></p>
    </div>

    <div>
      <h3>More reading</h3>
      <p><a href='http://bost.ocks.org/mike/scroll/'>How To Scroll</a></p>
      <p><a href='http://vallandingham.me/scroller.html/'>So You Want to Build A Scroller</a></p>
      <p><a href='https://source.opennews.org/en-US/articles/behind-scenes-fewer-helmets-more-deaths/'>Making “Fewer Helmets, More Deaths”</a></p>
      <p><a href='http://www.nytimes.com/interactive/2015/10/27/world/greenland-is-melting-away.html'>Greenland Is Melting Away</a></p>
      <p><a href='http://www.theguardian.com/us-news/ng-interactive/2015/oct/19/homan-square-chicago-police-detainees'>Homan Square</a></p>
   </div>

    <div>
      <h3>Todos</h3>
      <p>- Simple examples
      <p>- Self explanatory graphics
      <p>- Swiper 
    </div>
  </div>


</div>

<h1 id='source'><a href='https://github.com/1wheel/graph-scroll'>contribute/view source on github</a></h1>


<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script>

var oldWidth = 0
function render(){
  if (oldWidth == innerWidth) return
  oldWidth = innerWidth

  var width = height = d3.select('#graph').node().offsetWidth
  var r = 40


  if (innerWidth <= 925){
    width = innerWidth
    height = innerHeight*.7
  }

  // return console.log(width, height)

  var svg = d3.select('#graph').html('')
    .append('svg')
      .attrs({width: width, height: height})

  // Parse the Data
d3.csv("percent-bachelors-degrees-women-usa.csv", function(data) {
  // List of groups = header of the csv files
  var keys = data.columns.slice(1)

  var x = d3.scaleLinear()
      .domain(d3.extent(data, function(d) { return d.Year; }))
      .range([50, width-50]);
    svg.append("g")
      .attr("transform", "translate(0," + height*0.57 + ")")
      .call(d3.axisBottom(x).tickSize(-height*0.7).tickValues([1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011]))
      .select(".domain").remove()
    //Customization
    svg.selectAll(".tick line").attr("stroke", "#b8b8b8")
  
    //Add X axis label:
    svg.append("text")
        .attr("text-anchor", "end")
        .attr("x", width-50)
        .attr("y", height-475)
        .text("Year");

  // Add Y axis
    // Add Y axis
    var y = d3.scaleLinear()
    .domain([-500, 500])
    .range([ height-200, -200]);

  // color palette
  var color = d3.scaleOrdinal()
    .domain(keys)
    .range(['#50514F','#F25F5C','#F9A061','#FFE066','#92AE83', '#70C1B3','#247BA0','#8B6D7E'])

  //stack the data?
  var stackedData = d3.stack()
    .offset(d3.stackOffsetSilhouette)
    .keys(keys)
    (data)

  // create a tooltip
  var Tooltip = svg
    .append("text")
    .attr("x", 80)
    .attr("y", 20)
    .style("opacity", 0)
    .style("font-size", 25)

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    Tooltip.style("opacity", 1)
    d3.selectAll(".myArea").style("opacity", .2)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = function(d,i) {
    grp = keys[i]
    Tooltip.text(grp)
           .style("fill","black")
           .style("stroke","black")
  }
  var mouseleave = function(d) {
    Tooltip.style("opacity", 0)
    d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")
   }


  // Area generator
  var area = d3.area()
    .x(function(d) { return x(d.data.Year); })
    .y0(function(d) { return y(d[0]); })
    .y1(function(d) { return y(d[1]); })

    // Show the areas
  svg
    .selectAll("mylayers")
    .data(stackedData)
    .enter()
    .append("path")
      .attr("class", "myArea")
      .style("fill", function(d) { return color(d.key); })
      .attr("d", area)
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave)

})


  // var gs = d3.graphScroll()
  //     .container(d3.select('.container-1'))
  //     .graph(d3.selectAll('container-1 #graph'))
  //     .eventId('uniqueId1')  // namespace for scroll and resize events
  //     .sections(d3.selectAll('.container-1 #sections > div'))
  //     // .offset(innerWidth < 900 ? innerHeight - 30 : 200)
  //     .on('active', function(i){
  //       var pos = [ {cx: width - r, cy: r},
  //                   {cx: r,         cy: r},
  //                   {cx: width - r, cy: height - r},
  //                   {cx: width/2,   cy: height/2} ][i]
        
  //       circle.transition().duration(1000)
  //           .attrs(pos)
  //         .transition()
  //           .style('fill', colors[i])
  //     })


  // var svg2 = d3.select('.container-2 #graph').html('')
  //   .append('svg')
  //     .attrs({width: width, height: height})

  // var path = svg2.append('path')

  // var gs2 = d3.graphScroll()
  //     .container(d3.select('.container-2'))
  //     .graph(d3.selectAll('.container-2 #graph'))
  //     .eventId('uniqueId2')  // namespace for scroll and resize events
  //     .sections(d3.selectAll('.container-2 #sections > div'))
  //     .on('active', function(i){
  //       var h = height
  //       var w = width
  //       var dArray = [
  //         [[w/4, h/4], [w*3/4, h/4],  [w*3/4, h*3/4], [w/4, h*3/4]],
  //         [[0, 0],     [w*3/4, h/4],  [w*3/4, h*3/4], [w/4, h*3/4]],
  //         [[w/2, h/2], [w, h/4],      [w, h],         [w/4, h]],
  //         [[w/2, h/2], [w, h/4],      [w, h],         [w/4, h]],
  //         [[w/2, h/2], [w, h/2],      [0, 0],         [w/4, h/2]],
  //         [[w/2, h/2], [0, h/4],      [0, h/2],         [w/4, 0]],
  //       ].map(function(d){ return 'M' + d.join(' L ') })


  //       path.transition().duration(1000)
  //           .attr('d', dArray[i])
  //           .style('fill', colors[i])
  //     })

  d3.select('#source')
      .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
}
render()
d3.select(window).on('resize', render)


</script>
